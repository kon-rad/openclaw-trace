---
phase: 04-remote-push
plan: 02
type: execute
wave: 2
depends_on:
  - 04-01
files_modified:
  - internal/config/config.go
  - internal/app/runtime.go
  - cmd/openclaw-trace/main.go
autonomous: true
requirements:
  - PUSH-01
  - PUSH-02
  - PUSH-07
must_haves:
  truths:
    - "Push scheduler runs periodically when endpoint configured."
    - "Scheduler interval follows config."
    - "Shutdown performs final flush attempt before DB close."
  artifacts:
    - path: "internal/app/runtime.go"
      provides: "scheduled push loop + shutdown push call"
    - path: "internal/config/config.go"
      provides: "push payload size config"
  key_links:
    - from: "internal/app/runtime.go"
      to: "internal/push/pusher.go"
      via: "scheduled and shutdown PushOnce calls"
      pattern: "runPush"
---

<objective>
Wire the push engine into runtime lifecycle so remote delivery runs on interval and final flush executes during graceful shutdown.
</objective>

<tasks>
<task type="auto">
  <name>Task 1: Add runtime push scheduler</name>
  <files>internal/app/runtime.go</files>
  <action>Initialize pusher when endpoint exists and run periodic push loop using OCT_PUSH_INTERVAL.</action>
  <verify>`go test ./...` passes with runtime compilation and no regressions.</verify>
  <done>Periodic push behavior is active and non-fatal on intermittent failures.</done>
</task>
<task type="auto">
  <name>Task 2: Add shutdown final flush</name>
  <files>internal/app/runtime.go</files>
  <action>After ingest drain and before DB close, perform final push attempt with timeout and status tracking.</action>
  <verify>Runtime shutdown path compiles and tests pass; final push path is reachable in code.</verify>
  <done>PUSH-07 behavior is implemented.</done>
</task>
<task type="auto">
  <name>Task 3: Expose push payload cap in config and startup logs</name>
  <files>internal/config/config.go, cmd/openclaw-trace/main.go</files>
  <action>Add config field for max payload bytes (default 5MB) and include in startup diagnostics.</action>
  <verify>`go test ./...` and static linux build pass.</verify>
  <done>Runtime push tunables are fully configurable.</done>
</task>
</tasks>

<output>
After completion, create `.planning/phases/04-remote-push/04-02-SUMMARY.md`
</output>
