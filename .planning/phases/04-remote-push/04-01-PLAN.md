---
phase: 04-remote-push
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/db/push.go
  - internal/push/pusher.go
  - internal/push/pusher_test.go
autonomous: true
requirements:
  - PUSH-03
  - PUSH-04
  - PUSH-05
  - PUSH-06
  - PUSH-08
must_haves:
  truths:
    - "Unsynced rows are read across all event tables."
    - "Each pushed event includes trace_id in payload data."
    - "Rows are marked synced only after success."
    - "Large payloads are split by max payload size."
  artifacts:
    - path: "internal/db/push.go"
      provides: "unsynced event fetch + mark synced"
    - path: "internal/push/pusher.go"
      provides: "batch build/split, HTTP send, retry"
  key_links:
    - from: "internal/push/pusher.go"
      to: "internal/db/push.go"
      via: "fetch -> send -> mark synced"
      pattern: "FetchUnsyncedEvents|MarkEventsSynced"
---

<objective>
Build the reusable push engine for unsynced event delivery with payload splitting, retry logic, and synced-row updates.
</objective>

<tasks>
<task type="auto">
  <name>Task 1: Add DB push primitives</name>
  <files>internal/db/push.go</files>
  <action>Implement unsynced event reader across llm_traces/error_events/system_metrics and synced marking by table row IDs.</action>
  <verify>`go test ./internal/db -v` passes.</verify>
  <done>DB layer can provide push-ready events and mark successful deliveries.</done>
</task>
<task type="auto">
  <name>Task 2: Implement push client and payload splitting</name>
  <files>internal/push/pusher.go</files>
  <action>Implement push cycle with event envelope, max payload split behavior, and retry with full-jitter style backoff.</action>
  <verify>`go test ./internal/push -v` passes.</verify>
  <done>Pusher handles oversized payloads and failure retries robustly.</done>
</task>
<task type="auto">
  <name>Task 3: Add push integration tests</name>
  <files>internal/push/pusher_test.go</files>
  <action>Add success/failure/split tests and assert pending rows transition only on successful send.</action>
  <verify>Push package tests pass and validate row state transitions.</verify>
  <done>PUSH-03/04/05/06/08 are regression-protected.</done>
</task>
</tasks>

<output>
After completion, create `.planning/phases/04-remote-push/04-01-SUMMARY.md`
</output>
