---
phase: 05-log-parsing
plan: 02
type: execute
wave: 2
depends_on:
  - 05-01
files_modified:
  - internal/app/runtime.go
  - cmd/openclaw-trace/main.go
autonomous: true
requirements:
  - LOGP-01
  - LOGP-05
must_haves:
  truths:
    - "Runtime only starts parser loop when OCT_LOG_PATH is set."
    - "Parsed events flow through existing ingest channel and persistence."
  artifacts:
    - path: "internal/app/runtime.go"
      provides: "conditional parser loop wiring"
    - path: "cmd/openclaw-trace/main.go"
      provides: "startup diagnostics include configured log path"
  key_links:
    - from: "internal/app/runtime.go"
      to: "internal/logparse/parser.go"
      via: "background goroutine startup"
      pattern: "logparse.New"
---

<objective>
Wire parser lifecycle into runtime background loops and ensure parsed events use the same ingest channel as HTTP events.
</objective>

<tasks>
<task type="auto">
  <name>Task 1: Runtime conditional parser loop</name>
  <files>internal/app/runtime.go</files>
  <action>Start parser goroutine only when `OCT_LOG_PATH` is non-empty and tie cancellation to runtime shutdown.</action>
  <verify>`go test ./...` passes after runtime wiring changes.</verify>
  <done>LOGP-01 behavior is enforced by runtime wiring.</done>
</task>
<task type="auto">
  <name>Task 2: Keep parser events on standard ingest path</name>
  <files>internal/app/runtime.go</files>
  <action>Ensure parser emits into existing runtime enqueuer path (same counters and worker channel as trace/error/metric events).</action>
  <verify>No new DB write path introduced; build/tests pass.</verify>
  <done>LOGP-05 is satisfied via shared ingest path.</done>
</task>
<task type="auto">
  <name>Task 3: Startup diagnostics update</name>
  <files>cmd/openclaw-trace/main.go</files>
  <action>Include configured log path in startup config summary logs for observability.</action>
  <verify>Build passes and startup log includes `log_path` field.</verify>
  <done>Operator visibility for optional parser mode is present.</done>
</task>
</tasks>

<output>
After completion, create `.planning/phases/05-log-parsing/05-02-SUMMARY.md`
</output>
