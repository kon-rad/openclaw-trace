---
phase: 05-log-parsing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/config/config.go
  - internal/logparse/parser.go
  - internal/logparse/parser_test.go
autonomous: true
requirements:
  - LOGP-01
  - LOGP-02
  - LOGP-03
  - LOGP-04
must_haves:
  truths:
    - "Parser runs only when log path is configured."
    - "Parser follows appended lines."
    - "Parser classifies channel/gateway error/config lines into enrichment events."
  artifacts:
    - path: "internal/logparse/parser.go"
      provides: "tail-follow parser and classifier"
    - path: "internal/logparse/parser_test.go"
      provides: "line append + rotation tests"
  key_links:
    - from: "internal/logparse/parser.go"
      to: "internal/ingest/types.go"
      via: "ErrorPayload enrichment events"
      pattern: "EventKindError"
---

<objective>
Implement optional tail-follow log parser and classification logic with rotation handling and tests.
</objective>

<tasks>
<task type="auto">
  <name>Task 1: Add optional log parser configuration</name>
  <files>internal/config/config.go</files>
  <action>Add `OCT_LOG_PATH` config and help output wiring.</action>
  <verify>`go test ./...` passes.</verify>
  <done>Optional log mode is externally configurable.</done>
</task>
<task type="auto">
  <name>Task 2: Implement parser and enrichment mapping</name>
  <files>internal/logparse/parser.go</files>
  <action>Implement poll-based tail reader, line classification, and ingest event emission.</action>
  <verify>Parser package tests pass.</verify>
  <done>LOGP-02/03/04 behavior exists in parser implementation.</done>
</task>
<task type="auto">
  <name>Task 3: Add parser tests including rotation</name>
  <files>internal/logparse/parser_test.go</files>
  <action>Add tests for appended-line parsing and file rotation reopen behavior.</action>
  <verify>`go test ./internal/logparse -v` passes.</verify>
  <done>Parser behavior is regression-protected.</done>
</task>
</tasks>

<output>
After completion, create `.planning/phases/05-log-parsing/05-01-SUMMARY.md`
</output>
